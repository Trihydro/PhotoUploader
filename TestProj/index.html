<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script src="scripts/hello-world.js"></script>
        <script src="kendo/js/kendo.list.js"></script>
        <script src="kendo/js/kendo.popup.js"></script>
        <script src="kendo/js/kendo.dropdownlist.js"></script>
        <script src="kendo/js/kendo.datepicker.js"></script>

        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
        <link href="kendo/styles/kendo.common.css" rel="stylesheet" />
        <link href="kendo/styles/kendo.default.css" rel="stylesheet" />
    </head>
    <body>
        <div data-role="view" id="tabstrip-home" data-title="Hello World!">
            <h1>Welcome!</h1>
            <h2>Please log in...</h2>
            <p>
                <table>
                    <tr>
                        <td>
                            Username:    
                        </td>
                        <td>
                            <input type="text" id="txtUsername" value="" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Password:
                        </td>
                        <td>
                            <input type="password" id="pass" />
                        </td>
                    </tr>
                </table>
                <a id="loginButton" data-role="button" data-click="LoginUser" data-icon="compose">Log in</a>
            </p>
        </div>

        <div data-role="view" id="tabstrip-uiinteraction" data-title="UI Interaction">
            <h1>Select a Project</h1>
            <div id='helloWorldInput'>
                <table>
                    <tr>
                        <td>
                            Projects:
                        </td>
                        <td>
                            <input id="ddlProjects" />
                        </td>
                    </tr>
                </table>
                <br />
            </div>
            <div id="divPhoto" style="display:none;">
                <table>
                    <tr>
                        <td>
                            Photographer:
                        </td>
                        <td>
                            <input id="photographer" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Date Taken:
                        </td>
                        <td>
                            <input id="rdpDateTaken" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            &nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Direction:
                        </td>
                        <td>
                            <input id="ddlDirection" />
                        </td>
                    </tr>
                </table>
            </div>
            <br/>
        </div>

        <div data-role="view" id="tabstrip-geolocation" data-title="Geolocation">
            <h1>Geo</h1>
            <!--<div id="geoLocationContainer">
                <div id="myLocation">Unable to get location information. Please check your network connection and try again.</div>
                <a id="refreshMap" data-role="button" data-click="getLocation" data-icon="refresh">Refresh Location</a>
                <div id="map_canvas"></div>
            </div>-->
        </div>

        <div data-role="layout" data-id="mobile-tabstrip">
            <header data-role="header">
                <div data-role="navbar">
                    <span data-role="view-title"></span>
                </div>
            </header>

            <div data-role="footer">
                <div data-role="tabstrip">
                    <a href="#tabstrip-home" data-icon="home">Home</a>
                    <!--<a href="#tabstrip-uiinteraction" data-icon="share">UI Interaction</a>-->
                    <a href="#tabstrip-geolocation" data-icon="globe">Geolocation</a>
                </div>
            </div>
        </div>

         <div data-role="layout" data-id="mobile-tabstrip" data-platform="android">
            <div data-role="footer">
                <div data-role="tabstrip">
                    <a href="#tabstrip-home" data-icon="home">Home</a>
                    <!--<a href="#tabstrip-uiinteraction" data-icon="share">UI Interaction</a>-->
                    <a href="#tabstrip-geolocation" data-icon="globe">Geolocation</a>
                </div>
            </div>
        </div>

        <script>   
            
             var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "mobile-tabstrip" });
            $(document).ready(function(){
                app.navigate("#tabstrip-home");
            });
            
            function LoginUser(){
                var userName = document.getElementById('txtUsername').value;
                var passWord = document.getElementById('pass').value;
                
                $.ajax({
                    type: "GET",
                    url: "http://monoservicetest.trihydro.com/MobilePhoto/PhotoService.svc/LoginUser",
                    data: { userName: userName, password: passWord },
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data){
                        
                        if(data.d == "-1"){
                            alert("Incorrect username or password");
                            app.navigate("#tabstrip-home");
                            return;
                        }
                        app.navigate("#tabstrip-uiinteraction");
                        
                        $("#ddlProjects").kendoDropDownList({
                            change: ddlProjectsOnChange,
                            dataTextField: "PortalName",
                            dataValueField: "PortalKey",
                            dataSource:{
                                transport: {
                                    read: {
                                        url: "http://monoservicetest.trihydro.com/MobilePhoto/PhotoService.svc/GetProjects",
                                        data: { userkey: data.d },
                                        dataType: "json",
                                    }
                                },
                                schema: {
                                    data: "d"
                                }
                            },
                        });
                    },
                    error: function(data){
                        alert("Incorrect username or password");
                        },
                    });
                
                
                /*app.navigate("#tabstrip-uiinteraction");
                
                $("#ddlProjects").kendoDropDownList({
                    dataTextField: "PortalName",
                    dataValueField: "PortalKey",
                    dataSource:{
                        transport: {
                            read: {
                                url: "http://monoservicetest.trihydro.com/MobilePhoto/PhotoService.svc/GetProjects",
                                data: { userkey: 1020 },
                                dataType: "json",
                            }
                        },
                        schema: {
                            data: "d"
                        }
                    },
                });*/
                
                /*$.ajax({
                    type: "GET",
                    url: "http://monoservicetest.trihydro.com/MobilePhoto/PhotoService.svc/GetProjects",
                    data: { userkey: 1020 },
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: test,
                    error: errorTest,
                })*/
                
            }
            
            function ddlProjectsOnChange(){
                //$("#rdpDateTaken").kendoDatePicker();
                document.getElementById("divPhoto").style.display = "block";
                var portalKey = $("#ddlProjects").val();
                $("#ddlDirection").kendoDropDownList({
                    dataTextField: "Direction",
                    dataValueField: "DirectionKey",
                    dataSource: {
                        transport: {
                            read: {
                                url: "http://monoservicetest.trihydro.com/MobilePhoto/PhotoService.svc/GetDirections",
                                data: {portalKey: portalKey},
                                datatype: "json",
                            }
                        },
                        schema: {
                            data: "d"
                        }
                    }
                });
            }
        </script>
    </body>
</html>
